<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citizen Starter Guide - Mining Intel</title>
    <style>
        body { background:#000; color:#FFB300; font-family: monospace; padding:15px; line-height: 1.4; }
        .header { border-bottom:1px solid #332200; margin-bottom:20px; padding-bottom:10px; }
        
        /* Status Indicator */
        .status-pill { display: inline-block; padding: 2px 8px; font-size: 10px; border-radius: 3px; margin-bottom: 5px; font-weight: bold; }
        .live { background: #004400; color: #00FF00; border: 1px solid #00FF00; }
        .backup { background: #442200; color: #FFB300; border: 1px solid #FFB300; }
        
        /* Form Elements */
        label { font-size: 10px; text-transform: uppercase; color: #665500; display: block; margin-top: 10px; margin-bottom: 2px; }
        select, button { 
            background:#111; color:#FFB300; border:1px solid #FFB300; 
            padding:12px; margin-bottom:10px; width:100%; font-size: 16px;
            border-radius:0; outline: none;
        }
        button { background:#1a1a1a; font-weight:bold; cursor:pointer; text-transform:uppercase; transition: 0.2s; }
        button:hover { background:#FFB300; color:#000; }
        
        /* Results Styling */
        .card { border:1px solid #332200; border-left:4px solid #FFB300; padding:12px; margin-bottom:10px; background:#050505; }
        .loc-name { color: #fff; font-size: 16px; font-weight: bold; border-bottom: 1px solid #222; padding-bottom: 5px; margin-bottom: 8px; display: block; }
        .row { display: flex; justify-content: space-between; font-size: 14px; padding: 4px 0; }
        .prob-val { color: #00FF00; }
    </style>
</head>
<body>
    <div class="header">
        <div id="data-status" class="status-pill">CONNECTING...</div>
        <h2 style="margin:5px 0;">> MINING_INTEL_SYSTEM</h2>
        <p style="font-size:10px; color:#666;">v45.1 | LIVE_SYNC_ENABLED</p>
    </div>

    <label>Select Star System</label>
    <select id="sys-select">
        <option value="Stanton">STANTON_SYSTEM</option>
        <option value="Pyro">PYRO_SYSTEM</option>
        <option value="Nyx">NYX_SYSTEM</option>
    </select>

    <label>Resource Priority 01</label>
    <select class="ore-sel" id="ore1"></select>

    <label>Resource Priority 02</label>
    <select class="ore-sel" id="ore2"></select>

    <label>Resource Priority 03</label>
    <select class="ore-sel" id="ore3"></select>

    <button onclick="scan()">Initiate Scan</button>

    <div id="results"></div>

    <script>
        let oreData, rockData;
        const BASE_URL = 'https://raw.githubusercontent.com/quattrobaje3na-png/sc-mining-tool/main/';
        
        // Full list of Mining Materials
        const MATERIALS = [
            "Agricium", "Aluminum", "Ammonia", "Beryl", "Bexalite", "Borase", 
            "Copper", "Corundum", "Gold", "Hephaestanite", "Ice", "Iron", 
            "Laranite", "Lindinium", "Quantainium", "Quartz", "Riccite", 
            "Savrilium", "Silicon", "Stileron", "Taranite", "Tin", "Titanium", 
            "Torite", "Tungsten"
        ];

        // 1. Populate Dropdowns Automatically
        function populateDropdowns() {
            const dropdowns = document.querySelectorAll('.ore-sel');
            const sortedMaterials = MATERIALS.sort();
            
            dropdowns.forEach(sel => {
                let html = '<option value="">- NO SELECTION -</option>';
                sortedMaterials.forEach(m => {
                    html += `<option value="${m}">${m.toUpperCase()}</option>`;
                });
                sel.innerHTML = html;
            });
        }

        // 2. Fetch Logic (Live with Fallback)
        async function loadData(liveFile, masterFile) {
            try {
                // Try live version first
                let res = await fetch(BASE_URL + liveFile, { cache: "no-store" });
                if (!res.ok) throw new Error();
                return { data: await res.json(), source: 'LIVE' };
            } catch (e) {
                // Fallback to master version
                let res = await fetch(BASE_URL + masterFile);
                return { data: await res.json(), source: 'MASTER' };
            }
        }

        async function init() {
            populateDropdowns();
            const statusIndicator = document.getElementById('data-status');

            const oreRes = await loadData('ore_locations_live.json', 'ore_locations.json');
            const rockRes = await loadData('rock_live.json', 'rock.json');

            oreData = oreRes.data;
            rockData = rockRes.data;

            if (oreRes.source === 'LIVE') {
                statusIndicator.className = "status-pill live";
                statusIndicator.innerText = "DATABASE: LIVE_UPDATED";
            } else {
                statusIndicator.className = "status-pill backup";
                statusIndicator.innerText = "DATABASE: MASTER_FALLBACK";
            }
        }

        // 3. Search and Filter Logic
        function scan() {
            const out = document.getElementById('results');
            const picks = Array.from(document.querySelectorAll('.ore-sel'))
                               .map(s => s.value)
                               .filter(v => v !== "");
            
            out.innerHTML = "";
            if (!oreData) return;

            let foundAny = false;

            // Iterate through locations in the dataset
            for (let loc in oreData) {
                let matches = [];
                let totalProb = 0;

                picks.forEach(p => {
                    // Match case-insensitively
                    const key = Object.keys(oreData[loc].ores || {})
                                      .find(k => k.toLowerCase() === p.toLowerCase());
                    
                    if (key) {
                        const prob = oreData[loc].ores[key];
                        matches.push({ name: key, prob: (prob * 100).toFixed(1) });
                        totalProb += prob;
                    }
                });

                if (matches.length > 0) {
                    foundAny = true;
                    const card = document.createElement('div');
                    card.className = "card";
                    
                    let rowsHtml = matches.map(m => `
                        <div class="row">
                            <span>${m.name.toUpperCase()}</span>
                            <span class="prob-val">${m.prob}%</span>
                        </div>
                    `).join('');

                    card.innerHTML = `
                        <span class="loc-name">${loc.toUpperCase()}</span>
                        ${rowsHtml}
                    `;
                    out.appendChild(card);
                }
            }

            if (!foundAny) {
                out.innerHTML = `<p style="color:#666; text-align:center;">NO DEPOSITS FOUND FOR SELECTED CRITERIA</p>`;
            }
        }

        window.onload = init;
    </script>
</body>
</html>
