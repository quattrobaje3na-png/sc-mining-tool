<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Citizen Starter Guide - Mining Intel</title>
    <style>
        body { background:#000; color:#FFB300; font-family: monospace; padding:15px; }
        .header { border-bottom:1px solid #332200; margin-bottom:20px; }
        .status-pill { display: inline-block; padding: 2px 8px; font-size: 10px; border-radius: 3px; font-weight: bold; margin-bottom: 10px; }
        .live { background: #004400; color: #00FF00; border: 1px solid #00FF00; }
        .backup { background: #442200; color: #FFB300; border: 1px solid #FFB300; }
        
        label { font-size: 10px; color: #665500; display: block; margin-top: 10px; }
        select, button { 
            background:#111; color:#FFB300; border:1px solid #FFB300; 
            padding:12px; margin-bottom:10px; width:100%; font-size: 16px; border-radius: 0;
        }
        button { background: #1a1a1a; cursor: pointer; text-transform: uppercase; font-weight: bold; }
        button:hover { background: #FFB300; color: #000; }

        .card { border: 1px solid #332200; border-left: 4px solid #FFB300; padding: 12px; margin-bottom: 10px; background: #050505; }
        .loc-title { color: #fff; font-size: 16px; font-weight: bold; display: block; }
        .row { display: flex; justify-content: space-between; align-items: center; font-size: 14px; padding: 8px 0; border-bottom: 1px solid #111; }
        .prob { color: #00FF00; font-weight: bold; font-size: 18px; }
        .meta-text { font-size: 10px; color: #666; text-transform: uppercase; }
    </style>
</head>
<body>
    <div class="header">
        <div id="data-status" class="status-pill backup">INITIATING...</div>
        <h2 style="margin:0;">> MINING_INTEL_v48.5</h2>
    </div>

    <label>Target_Star_System</label>
    <select id="sys-select">
        <option value="ALL">ALL_KNOWN_SYSTEMS</option>
        <option value="Stanton">STANTON</option>
        <option value="Pyro">PYRO</option>
        <option value="Nyx">NYX</option>
    </select>

    <label>Material_Priority_01</label>
    <select class="ore-sel"></select>
    <label>Material_Priority_02</label>
    <select class="ore-sel"></select>
    <label>Material_Priority_03</label>
    <select class="ore-sel"></select>

    <button onclick="scan()">Initiate Deep Scan</button>
    <div id="results"></div>

    <script>
        // HARDCODED MATERIALS - Menus will NEVER be empty again
        const MATERIALS = ["Agricium", "Aluminum", "Ammonia", "Beryl", "Bexalite", "Borase", "Copper", "Corundum", "Gold", "Hephaestanite", "Ice", "Iron", "Laranite", "Lindinium", "Quantainium", "Quartz", "Riccite", "Savrilium", "Silicon", "Stileron", "Taranite", "Tin", "Titanium", "Torite", "Tungsten"];

        const ROCK_MAP = {
            "Laranite": { type: "P/Q-Type", sig: "4750/4870" },
            "Quantainium": { type: "Q-Type", sig: "4870" },
            "Hephaestanite": { type: "C-Type", sig: "4700" },
            "Beryl": { type: "S/E-Type", sig: "4720/4900" },
            "Agricium": { type: "M-Type", sig: "4850" },
            "Taranite": { type: "M-Type", sig: "4850" },
            "Titanium": { type: "E-Type", sig: "4900" },
            "Borase": { type: "C-Type", sig: "4700" },
            "Tungsten": { type: "P-Type", sig: "4750" },
            "Copper": { type: "P-Type", sig: "4750" },
            "Corundum": { type: "S-Type", sig: "4720" },
            "Ammonia": { type: "I-Type", sig: "4000" },
            "Quartz": { type: "C/P/Q-Type", sig: "4700/4750/4870" },
            "Torite": { type: "M-Type", sig: "4850" },
            "Aluminum": { type: "S/E-Type", sig: "4720/4900" }
        };

        let oreData, sortingData;
        const BASE_URL = 'https://raw.githubusercontent.com/quattrobaje3na-png/sc-mining-tool/main/';

        // Immediately populate dropdowns
        document.querySelectorAll('.ore-sel').forEach(s => {
            s.innerHTML = '<option value="">- SELECT MATERIAL -</option>' + 
                MATERIALS.sort().map(m => `<option value="${m}">${m.toUpperCase()}</option>`).join('');
        });

        async function init() {
            const status = document.getElementById('data-status');
            try {
                // Fetch Sorting Groups
                const sRes = await fetch(BASE_URL + 'system_sorting.json');
                if(sRes.ok) sortingData = await sRes.json();

                // Fetch Ore Data (Try Live First)
                try {
                    const oRes = await fetch(BASE_URL + 'ore_locations_live.json', { cache: "no-store" });
                    if (!oRes.ok) throw new Error();
                    oreData = await oRes.json();
                    status.className = "status-pill live";
                    status.innerText = "DB: LIVE_DATA_ACTIVE";
                } catch (e) {
                    const oRes = await fetch(BASE_URL + 'ore_locations.json');
                    oreData = await oRes.json();
                    status.className = "status-pill backup";
                    status.innerText = "DB: MASTER_BACKUP_ACTIVE";
                }
            } catch (err) {
                status.innerText = "DB: OFFLINE";
            }
        }

        function scan() {
            const out = document.getElementById('results');
            const selectedSys = document.getElementById('sys-select').value;
            const picks = Array.from(document.querySelectorAll('.ore-sel')).map(s => s.value).filter(v => v);
            
            out.innerHTML = "";
            if (!oreData) return;

            for (let loc in oreData) {
                // Determine System Grouping
                let locSystem = "Stanton";
                if (sortingData && sortingData.star_system_groups) {
                    for (let sys in sortingData.star_system_groups) {
                        if (sortingData.star_system_groups[sys].some(s => loc.includes(s))) {
                            locSystem = sys;
                            break;
                        }
                    }
                }
                if (selectedSys !== "ALL" && selectedSys !== locSystem) continue;

                let matches = [];
                picks.forEach(p => {
                    const locOres = oreData[loc].ores || oreData[loc];
                    // Strict Case-Insensitive Key Matching
                    const matKey = Object.keys(locOres).find(k => k.toUpperCase() === p.toUpperCase());
                    
                    if (matKey && locOres[matKey]) {
                        const meta = ROCK_MAP[p] || { type: "GEN-TYPE", sig: "SCAN" };
                        const probValue = locOres[matKey].prob !== undefined ? locOres[matKey].prob : locOres[matKey];
                        
                        matches.push({ 
                            name: p.toUpperCase(), 
                            prob: (probValue * 100).toFixed(1),
                            rock: meta.type,
                            sig: meta.sig
                        });
                    }
                });

                if (matches.length > 0) {
                    const card = document.createElement('div');
                    card.className = "card";
                    let rows = matches.map(m => `
                        <div class="row">
                            <div style="display:flex; flex-direction:column;">
                                <span style="font-weight:bold; color:#fff;">${m.name}</span>
                                <span class="meta-text">HUNT: ${m.rock} | SIG: ${m.sig}</span>
                            </div>
                            <span class="prob">${m.prob}%</span>
                        </div>
                    `).join('');

                    card.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                            <span class="loc-title">${loc.toUpperCase()}</span>
                            <span style="font-size:9px; color:#554400; border:1px solid #332200; padding:1px 4px;">${locSystem.toUpperCase()}</span>
                        </div>
                        ${rows}
                    `;
                    out.appendChild(card);
                }
            }
        }

        init();
    </script>
</body>
</html>
